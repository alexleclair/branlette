// Generated by CoffeeScript 1.6.3
(function(){var e,t=this;e={config:{endpoint:"http://alexleclair.ca:8090/"},socket:null,labels:{},agencies:{},code:null,agency:null,shakes:0,isMobile:!1,shakeTimeout:null,objects:["marie","jesus","nutcracker","emballage","boite","canne","explosif","ange","roi","canne2","cierge","boule"],currentObject:null,init:function(t){e.socket=io.connect(e.config.endpoint);e.socket.on("labels",function(t){e.labels=t;return e.resetTexts()});e.socket.on("pick",function(t){e.agency=t;e.shakes=0;e.resetTexts();$("body").addClass("has-agency");if(e.isMobile)return e.gotoPage("pageiphone-shake");e.gotoPage("page-shake","shake-intro");return e.changeObject(e.objects[Math.floor(Math.random()*(e.objects.length-1))])});e.socket.on("object",function(t){return e.changeObject(t)});e.socket.on("shake",function(){e.shakes++;$('div[data-info="shake-sessioncount"]').text(e.shakes);$(".shake-bras").effect("shake",{direction:"up",times:1});clearTimeout(e.shakeTimeout);$("body").addClass("shake");e.shakeTimeout=setTimeout(function(){$("body").removeClass("shake");$(".shake-bras").stop(!0);if(!e.isMobile)return e.gotoPage("page-shake","shake-repos",500)},1500);if(!e.isMobile)return e.gotoPage("page-shake","shake-shake",0)});e.socket.on("agencies",function(t){e.agencies=t;e.refreshLeaderboards();return e.resetTexts()});e.socket.on("siblingsCount",function(t){!e.isMobile&&$("div.step.current").is(".page-landing")&&e.gotoPage("page-landing","landing-confirmation");if(e.isMobile&&$("div.step.current").is(".pageiphone-landing"))return e.gotoPage("pageiphone-agence")});return e.socket.on("code",function(t){e.code=t;return e.refreshCodeScreen()})},bindToCode:function(t){return e.socket.emit("registerSibling",t)},pickAgency:function(t){return e.socket.emit("pick",t)},shake:function(t){t==null&&(t=e.agency);return e.socket.emit("shake",t)},changeObject:function(t,n){var r,i,s,o;n==null&&(n=!1);r=($("body").attr("class")+"").split(" ");for(i=s=0,o=r.length;0<=o?s<o:s>o;i=0<=o?++s:--s)r[i].substr(0,7)==="object-"&&$("body").removeClass(r[i]);$("body").addClass("object-"+t);e.currentObject=t;if(n)return e.socket.emit("object",t)},resetTexts:function(){var t,n,r,i,s,o,u,a,f,l,c,h,p;n=e.agency;e.labels!=null&&e.labels[n]!=null&&$(".agencyName").text(e.labels[n]);if(e.agencies!=null&&e.agencies[n]){t=e.sortAgencies();i=-1;for(r=l=0,h=t.length;0<=h?l<h:l>h;r=0<=h?++l:--l)if(t[r].key===n){i=r+1;break}$(".agencyIndex").text(i);$(".agenciesCount").text(t.length)}if(e.labels!=null){a=[];f={};for(s in e.labels){a.push(e.labels[s]);f[e.labels[s]]=s}a.sort();for(r=c=0,p=a.length;0<=p?c<p:c>p;r=0<=p?++c:--c)a[r]={name:a[r],key:f[a[r]]};o=$("#template-agencies-list").html();u=Handlebars.compile(o);$("#agency-picker").html(u({agencies:a}));return $("#agency-picker li a").click(function(t){t.preventDefault();e.pickAgency($(this).attr("data-key"));return!1})}},refreshCodeScreen:function(){$('div[data-info="code"]').text(e.code);return $("div.landing-code .biphone-contenu").show()},refreshLeaderboards:function(){var t,n,r;t=e.sortAgencies();n=$("#template-leaderboard").html();r=Handlebars.compile(n);$("#top5").html(r({limit:5,agencies:t}));return $("#leaderboard").html(r({limit:t.length,agencies:t}))},gotoPage:function(e,t,n){var r;n==null&&(n=500);if(window.isOli!=null||(window.location+"").indexOf("static")>0)return;r=$("div.step."+e);$("div.step.current").is("."+e)||$("div.step").hide().removeClass("current");t!=null&&!r.find(".substep.current").is("."+t)&&r.find(".substep").fadeOut(n,function(e){r.find(".substep").removeClass("current");return r.find(".substep."+t).fadeIn(n).addClass("current")});return r.fadeIn(n).addClass("current")},sortAgencies:function(t){var n,r,i,s,o,u,a,f;t==null&&(t=null);t==null&&(t=e.agencies);s=[];for(r in t){i={name:e.labels[r],key:r,score:parseInt(t[r].count),people:parseInt(t[r].people)};if(s.length===0||i.score>s[s.length-1].score){s.push(i);continue}for(n=o=0,a=s.length;0<=a?o<a:o>a;n=0<=a?++o:--o)if(s[n].score>=i.score){s.splice(n,0,i);break}}s.reverse();for(n=u=0,f=s.length;0<=f?u<f:u>f;n=0<=f?++u:--u)s[n].rank=n+1;return s}};$(function(){var t,n,r,i,s,o,u;Handlebars.registerHelper("each_upto",function(e,t,n){var r,i,s,o;if(!e||e.length===0)return n.inverse(this);i=[];for(r=s=0,o=Math.min(e.length,t);0<=o?s<o:s>o;r=0<=o?++s:--s)i.push(n.fn(e[r]));return i.join("")});e.init();if(/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){e.gotoPage("pageiphone-landing");e.isMobile=!0}else e.gotoPage("page-landing","landing-intro");if(window.DeviceMotionEvent!=null){t=20;n=0;i=0;o=0;r=0;s=0;u=0;window.addEventListener("devicemotion",function(e){n=e.accelerationIncludingGravity.x;i=e.accelerationIncludingGravity.y;o=e.accelerationIncludingGravity.z;e.preventDefault();return!1},!1);return setInterval(function(){var a;a=Math.abs(n-r+i-s+o-u);a>t&&e.shake();r=n;s=i;return u=o},150)}});window.Branlette=e}).call(this);